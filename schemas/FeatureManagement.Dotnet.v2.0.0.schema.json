{
  "definitions": {},
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "title": "A .NET Feature Management Configuration",
  "required": [
    "FeatureManagement"
  ],
  "properties":{
    "FeatureManagement": {
      "type": "object",
      "title": "Feature Management",
      "description": "Declares feature management configuration.",
      "required": [],
      "patternProperties": {
        "^[^:]*$": {
          "description": "Declares a feature flag.",
          "anyOf": [
            {
              "type": "boolean",
              "title": "On/Off Feature Flag",
              "description": "A feature flag that always returns the same value."
            },
            {
              "type": "object",
              "title": "Conditional Feature Flag",
              "description": "A feature flag which value is dynamic based on a set of feature filters",
              "required": [
                "EnabledFor"
              ],
              "properties": {
                "Status": {
                  "type": "string",
                  "title": "Feature Status",
                  "description": "Describes how a feature's state will be evaluated. When set to Conditional, the state of the feature is conditional upon the feature evaluation pipeline. When set to Disabled, the state of feature is always disabled.",
                  "enum": [
                    "Conditional",
                    "Disabled"
                  ],
                  "default": "Conditional"
                },
                "RequirementType": {
                  "type": "string",
                  "title": "Requirement Type",
                  "description": "Determines whether any or all registered feature filters must be enabled for the feature to be considered enabled.",
                  "enum": [
                    "Any",
                    "All"
                  ],
                  "default": "Any"
                },
                "EnabledFor": {
                  "oneOf": [
                    {
                      "type": "array",
                      "title": "Feature Filter Collection",
                      "description": "Feature filters that are evaluated to conditionally enable the flag.",
                      "items": {
                        "type": "object",
                        "title": "Feature Filter Declaration",
                        "required": [
                          "Name"
                        ],
                        "properties": {
                          "Name": {
                            "type": "string",
                            "title": "Feature Filter Name",
                            "description": "The name used to refer to and require a feature filter.",
                            "default": "",
                            "examples": [
                              "Percentage",
                              "TimeWindow"
                            ],
                            "pattern": "^[^:]*$"
                          },
                          "Parameters": {
                            "type": "object",
                            "title": "Feature Filter Parameters",
                            "description": "Custom parameters for a given feature filter. A feature filter can require any set of parameters of any type.",
                            "required": [],
                            "patternProperties": {
                              "^.*$": {
                                "anyOf": [
                                  {
                                    "type": "string"
                                  },
                                  {
                                    "type": "null"
                                  },
                                  {
                                    "type": "object"
                                  },
                                  {
                                    "type": "number"
                                  },
                                  {
                                    "type": "array"
                                  },
                                  {
                                    "type": "boolean"
                                  }
                                ]
                              }
                            }
                          }
                        }
                      }
                    },
                    {
                      "type": "boolean"
                    }
                  ]
                },
                "Variants": {
                  "type": "array",
                  "title": "Variant Collection",
                  "description": "The list of variants defined for this feature. A variant represents a configuration value of a feature flag that can be a string, a number, a boolean, or a JSON object.",
                  "items": {
                    "type": "object",
                    "title": "Variant",
                    "required": [
                      "Name"
                    ],
                    "properties":{
                      "Name": {
                        "type": "string",
                        "title": "Variant Name",
                        "description": "The name used to refer to a feature variant.",
                        "pattern": "^(.*)$"
                      },
                      "ConfigurationValue": {
                        "type": ["string", "null", "number", "object", "array", "boolean"],
                        "title": "Variant Configuration Value",
                        "description": "The configuration value for this feature variant.",
                        "default": null
                      },
                      "ConfigurationReference": {
                        "type": "string",
                        "title": "Variant Configuration Reference",
                        "description": "The path to a configuration section used as the configuration value for this feature variant.",
                        "pattern": "^[a-zA-Z0-9]+(:[a-zA-Z0-9]+)*$"
                      },
                      "StatusOverride": {
                        "type": "string",
                        "title": "Variant Status Override",
                        "description": "Overrides the enabled state of the feature if the given variant is assigned. Does not override the state if value is None.",
                        "enum": [
                            "None",
                            "Enabled",
                            "Disabled"
                        ],
                        "default": "None"
                      }
                    }
                  }
                },
                "Allocation": {
                  "type": "object",
                  "title": "Variant Allocation",
                  "description": "Determines how variants should be allocated for the feature to various users.",
                  "required": [],
                  "properties": {
                    "DefaultWhenDisabled": {
                      "type": "string",
                      "title": "Default Variant Allocation When Disabled",
                      "description": "Specifies which variant should be used when the feature is considered disabled.",
                      "default": "",
                      "pattern": "^(.*)$"
                    },
                    "DefaultWhenEnabled": {
                      "type": "string",
                      "title": "Default Variant Allocation When Enabled",
                      "description": "Specifies which variant should be used when the feature is considered enabled and no other allocation rules are applicable.",
                      "default": "",
                      "pattern": "^(.*)$"
                    },
                    "User": {
                      "type": "array",
                      "title": "User Allocation Collection",
                      "description": "A list of objects, each containing a variant name and list of users for whom that variant should be used.",
                      "items": {
                        "type": "object",
                        "title": "User Allocation",
                        "required": [
                          "Variant",
                          "Users"
                        ],
                        "properties": {
                          "Variant": {
                            "type": "string",
                            "title": "User Allocation Variant",
                            "description": "The name of the variant to use if the user allocation matches the current user.",
                            "pattern": "^(.*)$"
                          },
                          "Users": {
                            "type": "array",
                            "title": "User Allocation Users Collection",
                            "description": "Collection of users where if any match the current user, the variant specified in the user allocation is used.",
                            "items": {
                              "type": "string"
                            }
                          }
                        }
                      }
                    },
                    "Group": {
                      "type": "array",
                      "title": "Group Allocation Collection",
                      "description": "A list of objects, each containing a variant name and list of groups for which that variant should be used.",
                      "items": {
                        "type": "object",
                        "title": "Group Allocation",
                        "required": [
                          "Variant",
                          "Groups"
                        ],
                        "properties": {
                          "Variant": {
                            "type": "string",
                            "title": "Group Allocation Variant",
                            "description": "The name of the variant to use if the group allocation matches a group the current user is in.",
                            "pattern": "^(.*)$"
                          },
                          "Groups": {
                            "type": "array",
                            "title": "Group Allocation Groups Collection",
                            "description": "Collection of groups where if the current user is in any of these groups, the variant specified in the group allocation is used.",
                            "items": {
                                "type": "string"
                            }
                          }
                        }
                      }
                    },
                    "Percentile": {
                      "type": "array",
                      "title": "Percentile Allocation Collection",
                      "description": "A list of objects, each containing a variant name and percentage range for which that variant should be used.",
                      "items": {
                        "type": "object",
                        "title": "Percentile Allocation",
                        "required": [
                          "Variant",
                          "From",
                          "To"
                        ],
                        "properties": {
                          "Variant": {
                            "type": "string",
                            "title": "Percentile Allocation Variant",
                            "description": "The name of the variant to use if the calculated percentile for the current user falls in the provided range.",
                            "pattern": "^(.*)$"
                          },
                          "From": {
                            "type": "number",
                            "title": "Percentile Allocation From",
                            "description": "The lower end of the percentage range for which this variant will be used.",
                            "minimum": 0,
                            "maximum": 100
                          },
                          "To": {
                            "type": "number",
                            "title": "Percentile Allocation To",
                            "description": "The upper end of the percentage range for which this variant will be used.",
                            "minimum": 0,
                            "maximum": 100
                          }
                        }
                      }
                    },
                    "Seed": {
                      "type": "string",
                      "title": "Percentile Allocation Seed",
                      "description": "The value percentile calculations are based on. The calculated percentile is consistent across features for a given user if the same nonempty seed is used.",
                      "default": "",
                      "pattern": "^(.*)$"
                    }
                  }
                },
                "Telemetry": {
                  "type": "object",
                  "title": "Telemetry Options",
                  "description": "The declaration of options used to configure telemetry for this feature.",
                  "required": [],
                  "properties": {
                    "Enabled": {
                      "type": "boolean",
                      "title": "Telemetry Enabled State",
                      "description": "Indicates if telemetry is enabled.",
                      "default": false
                    },
                    "Metadata": {
                      "type": "object",
                      "title": "Telemetry Metadata",
                      "description": "A container for metadata that should be bundled with flag telemetry.",
                      "required": [],
                      "patternProperties": {
                          "^.*$": {
                            "type": "string"
                          }
                      },
                      "additionalProperties": false
                    }
                  }
                }
              }
            }
          ]
        }
      }
    }
  }
}
